
<script type="text/javascript">
	$(document).ready(function () {
	    $('#birthday').datepicker({
	    	 format: "dd/mm/yyyy",
	    	 language: "vi",
	    	 todayHighlight: true,
	    	 todayBtn: true,
	    	 autoclose: true
	    });
		$('#lstUserGroup').select2({
		});
		$('#lstUserRole').select2({
		});

        var isFormChanged = false;
        var isConfirmed = false;
        $("form :input").change(function() {
            console.log($(this).attr('name') + " has changed");
            isFormChanged = true;
            $("#isFormChanged").val(true);
        });
        
        $("#lstUserGroup").change(function() {
        	console.log("UserGroup has changed");
        	$("#isUserGroupChanged").val(true);
        	 $("#isFormChanged").val(true);
        })
        
        $("#lstUserRole").change(function() {
        	console.log("UserRole has changed");
        	$("#isUserRoleChanged").val(true);
        	 $("#isFormChanged").val(true);
        })
        
        $('#status').change(function() {
            if(this.checked) {
                $('#statusLabel').text("Kích hoạt");
            } else {
            	$('#statusLabel').text("Khóa");
            }
            
        });

	});
</script>

<!-- form start -->
<form class="form-horizontal" th:action="@{/user/save}" method="post">
	<div class="row">
		<div class="col-lg-12">
			<input type="hidden" id="isFormChanged" name="isFormChanged" value="false"> <input type="hidden"
				id="isUserGroupChanged" name="isUserGroupChanged" value="false"> <input type="hidden" id="isUserRoleChanged"
				name="isUserRoleChanged" value="false"> <input type="hidden" id="id" name="id" th:value="${user.id}">

			<div class="form-group row">
				<label for="username" class="col-sm-2 col-form-label">Tài khoản</label>
				<div class="col-sm-5">
					<input type="text" class="form-control" id="username" name="username" th:value="${user.username}">
				</div>
			</div>
			<div class="form-group row">
				<label for="email" class="col-sm-2 col-form-label">Email</label>
				<div class="col-sm-5">
					<input type="email" class="form-control" id="email" name="email" th:value="${user.email}">
				</div>
			</div>
			<div class="form-group  row" th:if="${action=='create'}">
				<label for="password" class="col-sm-2 col-form-label">Mật khẩu</label>
				<div class="col-sm-5">
					<input type="password" class="form-control" id="password" name="password" th:value="${user.password}">
				</div>
			</div>
			<div class="form-group row">
				<label for="fullName" class="col-sm-2 col-form-label">Họ tên</label>
				<div class="col-sm-5">
					<input type="text" class="form-control" id="fullName" name="fullName" th:value="${user.fullName}">
				</div>
			</div>

			<div class="form-group row">
				<label class="col-sm-2 control-label text-right">Trạng thái</label>
				<div class="col-sm-5">
					<div class="custom-control custom-switch switch-primary">
						<input value="1" type="checkbox" name="status" class="custom-control-input" id="status" th:checked="${user.status==1}">
						<label id="statusLabel" class="custom-control-label" for="status">[[${user.status==1? "Kích hoạt":"Khóa"}]]</label>
					</div>
				</div>
			</div>

<!-- 			<div class="form-group row"> -->
<!-- 				<label for="type" class="col-sm-2 control-label">Loại người dùng</label> -->
<!-- 				<div class="col-sm-5"> -->
<!-- 					<select class="form-control" name="type"> -->
<!-- 						<option value="0" th:if="${session.principal.hasRole('ROLE_ADMIN')}" th:selected="${user.type==0}">Người dùng hệ -->
<!-- 							thống</option> -->
<!-- 						<option value="1" th:selected="${user.type==1}">Khách hàng</option> -->
<!-- 					</select> -->
<!-- 				</div> -->
<!-- 			</div> -->
			<div style="display: none" class="form-group row">
				<label for="lstUserGroup" class="col-sm-2 col-form-label">Nhóm</label>
				<div class="col-sm-5">
					<select id="lstUserGroup" class="form-control select2" style="width: 100%;" data-placeholder="Select group" name="groupIds"
						multiple>
						<option th:value="${group.id}" th:each="group : ${allGroups}"
							th:selected="${userGroups!=null && userGroups.contains(group.name)}">[[${group.name}]]</option>
					</select>
				</div>
			</div>
			<div th:if="${session.principal.hasRole('ROLE_ADMIN')}" class="form-group row">
				<label for="lstUserRole" class="col-sm-2 col-form-label">Quyền</label>
				<div class="col-sm-5">
					<select id="lstUserRole" class="form-control select2" style="width: 100%;" data-placeholder="Chọn quyền" name="roleIds"
						multiple>
						<option th:value="${role.id}" th:each="role : ${allRoles}"
							th:selected="${userRoleNames!=null && userRoleNames.contains(role.name)}">[[${role.name}]]</option>
					</select>
				</div>
			</div>
			<div style="display: none" class="form-group row">
				<label for="lstInheritedRole" class="col-sm-2 col-form-label">Quyền thừa kế từ nhóm</label> <label for=""
					lstInheritedRole"" class="col-sm-5">
					<p th:each="r : ${inheriteRoles}" th:text="${r.name}">Tên quyền</p>
				</label>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-sm-2"></div>
		<div class="col-sm-5 text-right">
			<a th:href="@{/user/}" class="btn btn-warning pull-left">[[#{back}]]</a>
			<a th:if="${action=='update'}" class="btn btn-gradient-danger" onclick="return confirm('Chắc chắn xóa?')" th:href="@{'/user/delete/' + ${user.id}}">[[#{delete}]]</a>
			<a th:if="${action!='create'}" th:href="@{'/user/resetPassword/' + ${user.id}}" class="btn btn-gradient-success">[[#{user.resetPassword}]]</a>
			<button type="submit" class="btn btn-gradient-primary" th:text="#{${action=='create'? 'save' : 'update'}}">Lưu</button>
		</div>

	</div>
</form>

